---
title: JavaScript 的堆与栈
date: 2018-03-12 00:12:17
tags: javascript
---
>这篇文章呢就来聊一聊，js的堆与栈的问题，这也是平时在处理业务问题的时候并不经常涉及到的问题，但却算是我的一个痛点吧。

### 数据类型

首先，了解一下JavaScript的基本数据类型，面试常考题吧！ 倒着都能说下来，**Number / String / Bollean / Undefined / Null / Symbol**.那么其他的不是基本的数据类型呢？就包括 **Object / Array / RegExp / Date** 等等。

### 堆与栈存储
下面呢，了解一下堆与栈的定义。

**栈存储（先进后出）**：是一块内存区域，存储的都是局部变量，像上面提到的六种基本类型就存放在栈内存中，是可以直接访问到的，存放在栈(stack)内存中的简单数据段，数据大小确定，内存空间大小可以分配。
**堆存储（先进先出）**：像Array等类型的变量实际保存的是一个指针，这个指针指向堆内存对应的实际内容实体。

  一张直观图表示：

![image](http://wx4.sinaimg.cn/mw690/a73bc6a1ly1fq8s7oymrjj212e0lqdho.jpg)

### 堆与栈的区别

 1. 栈内存存储的是局部变量而堆内存存储的是实体；
 2. 栈内存的更新速度要快于堆内存，因为局部变量的生命周期很短；
 3. 栈内存存放的变量生命周期一旦结束就会被释放，而堆内存存放的实体会被垃圾回收机制不定时的回收；
 4. 开发人员并不能直接操作堆内存，堆内存由JS引擎操作完成

### 深拷贝与浅拷贝
 通过上面的堆栈分析，就引申到了对象深浅拷贝的问题。
 - **浅拷贝**
通俗来讲只能复制一层对象的属性。深层的属性只能被引用。当被引用的深层属性值改变时，复制者也会随着改变。一张图看原理：
![image](http://wx4.sinaimg.cn/mw690/a73bc6a1ly1fq8t5rivvmj20gf075weq.jpg)
 - **深拷贝**
 深拷贝相反，会完完整整的深层遍历复制一个对象，而不是深层引用。如图：
![image](http://wx2.sinaimg.cn/mw690/a73bc6a1ly1fq8t5rz7uuj20g906wmxe.jpg)

 - **实现深拷贝**
	 1. 循环遍历
	 2. 利用JSON API
		 ```
		let newobj=JSON.parse(JSON.stringify(obj));
		```
	 3. 递归遍历

### 总结
1.基本数据类型都是直接在栈存储，其他数据类型只是一个指针，实体存放在堆中
2.由于非基本数据类型的数据结构造成浅拷贝和深拷贝的问题，可通过遍历或者 JSON的api方法实现深拷贝